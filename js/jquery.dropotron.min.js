(function(e){e.fn.disableSelection_dropotron=function(){return e(this).css("user-select","none").css("-khtml-user-select","none").css("-moz-user-select","none").css("-o-user-select","none").css("-webkit-user-select","none")};e.fn.dropotron=function(t){if(1<this.length)for(var n=0;n<this.length;n++)e(this[n]).dropotron(t);return e.dropotron(e.extend({selectorParent:e(this)},t))};e.dropotron=function(t){var n=e.extend({selectorParent:null,baseZIndex:1e3,menuClass:"dropotron",expandMode:"hover",hoverDelay:150,hideDelay:250,openerClass:"opener",openerActiveClass:"active",submenuClassPrefix:"level-",mode:"fade",speed:"fast",easing:"swing",alignment:"left",offsetX:0,offsetY:0,globalOffsetY:0,IEOffsetX:0,IEOffsetY:0,noOpenerFade:!0,detach:!0,cloneOnDetach:!0},t),r=n.selectorParent,i=r.find("ul"),s=e("html"),o=!1,u=null,a=null;r.on("doCollapseAll",function(){i.trigger("doCollapse")});i.each(function(){var t=e(this),r=t.parent();if(0<n.hideDelay)t.add(r).on("mouseleave",function(e){window.clearTimeout(a);a=window.setTimeout(function(){t.trigger("doCollapse")},n.hideDelay)});t.disableSelection_dropotron().hide().addClass(n.menuClass).css("position","absolute").on("mouseenter",function(e){window.clearTimeout(a)}).on("doExpand",function(){if(t.is(":visible"))return!1;window.clearTimeout(a);i.each(function(){var t=e(this);e.contains(t.get(0),r.get(0))||t.trigger("doCollapse")});var u=r.offset(),f=r.position();r.parent().position();var l=r.outerWidth(),h=t.outerWidth(),d=t.css("z-index")==n.baseZIndex,v,m,y;if(d){v=n.detach?u:f;y=v.top+r.outerHeight()+n.globalOffsetY;m=n.alignment;t.removeClass("left").removeClass("right").removeClass("center");switch(n.alignment){case"right":u=v.left-h+l;0>u&&(u=v.left,m="left");break;case"center":u=v.left-Math.floor((h-l)/2);0>u?(u=v.left,m="left"):u+h>s.width()&&(u=v.left-h+l,m="right");break;default:u=v.left,u+h>s.width()&&(u=v.left-h+l,m="right")}t.addClass(m)}else switch("relative"==r.css("position")||"absolute"==r.css("position")?(y=n.offsetY,u=-1*f.left):(y=f.top+n.offsetY,u=0),n.alignment){case"right":u+=-1*r.parent().outerWidth()+n.offsetX;break;default:u+=r.parent().outerWidth()+n.offsetX}navigator.userAgent.match(/MSIE ([0-9]+)\./)&&8>RegExp.$1&&(u+=n.IEOffsetX,y+=n.IEOffsetY);t.css("left",u+"px").css("top",y+"px");t.css("opacity","0.01").show();l=!1;u="relative"==r.css("position")||"absolute"==r.css("position")?-1*f.left:0;0>t.offset().left?(u+=r.parent().outerWidth()-n.offsetX,l=!0):t.offset().left+h>s.width()&&(u+=-1*r.parent().outerWidth()-n.offsetX,l=!0);l&&t.css("left",u+"px");t.hide().css("opacity","1");switch(n.mode){case"zoom":o=!0;r.addClass(n.openerActiveClass);t.animate({width:"toggle",height:"toggle"},n.speed,n.easing,function(){o=!1});break;case"slide":o=!0;r.addClass(n.openerActiveClass);t.animate({height:"toggle"},n.speed,n.easing,function(){o=!1});break;case"fade":o=!0;d&&!n.noOpenerFade?(l="slow"==n.speed?80:"fast"==n.speed?40:Math.floor(n.speed/2),r.fadeTo(l,.01,function(){r.addClass(n.openerActiveClass);r.fadeTo(n.speed,1);t.fadeIn(n.speed,function(){o=!1})})):(r.addClass(n.openerActiveClass),r.fadeTo(n.speed,1),t.fadeIn(n.speed,function(){o=!1}));break;default:r.addClass(n.openerActiveClass),t.show()}return!1}).on("doCollapse",function(){if(!t.is(":visible"))return!1;t.hide();r.removeClass(n.openerActiveClass);t.find("."+n.openerActiveClass).removeClass(n.openerActiveClass);t.find("ul").hide();return!1}).on("doToggle",function(e){t.is(":visible")?t.trigger("doCollapse"):t.trigger("doExpand");return!1});r.disableSelection_dropotron().addClass("opener").css("cursor","pointer").on("click",function(e){o||(e.preventDefault(),e.stopPropagation(),t.trigger("doToggle"))});"hover"==n.expandMode&&r.hover(function(e){o||(u=window.setTimeout(function(){t.trigger("doExpand")},n.hoverDelay))},function(e){window.clearTimeout(u)})});i.find("a").css("display","block").on("click",function(t){o||(r.trigger("doCollapseAll"),t.stopPropagation(),1>e(this).attr("href").length&&t.preventDefault())});r.find("li").css("white-space","nowrap").each(function(){var t=e(this),n=t.children("a"),i=t.children("ul");if(0<n.length&&0==i.length)t.on("click",function(e){o||(r.trigger("doCollapseAll"),e.stopPropagation())})});r.children("li").each(function(){var t=e(this).children("ul"),r;if(0<t.length){n.detach&&(n.cloneOnDetach&&(r=t.clone(),r.attr("class","").hide().appendTo(t.parent())),t.detach().appendTo("body"));r=n.baseZIndex;for(var i=1;0<t.length;i++)t.css("z-index",r++),n.submenuClassPrefix&&t.addClass(n.submenuClassPrefix+(r-1-n.baseZIndex)),t=t.find("> li > ul")}});s.on("click",function(){o||r.trigger("doCollapseAll")}).on("keypress",function(e){o||27!=e.keyCode||(e.preventDefault(),r.trigger("doCollapseAll"))})}})(jQuery)